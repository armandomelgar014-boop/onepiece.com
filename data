<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Compartir Ubicaci√≥n Segura</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        button {
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 8px;
            border: none;
            background-color: #007bff;
            color: white;
        }
        #mensaje_estado {
            margin-top: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Ubicaci√≥n Segura</h1>
    <button onclick="obtenerUbicacion()">Compartir mi Ubicaci√≥n üìç</button>
    <p id="mensaje_estado">Esperando acci√≥n...</p>

    <script>
        function obtenerUbicacion() {
            const mensaje = document.getElementById('mensaje_estado');
            mensaje.innerText = "Solicitando permiso... Pulsa 'Permitir'.";

            if (!navigator.geolocation) {
                mensaje.innerText = "Tu navegador no soporta geolocalizaci√≥n.";
                return;
            }

            navigator.geolocation.getCurrentPosition(
                enviarUbicacion,
                manejarError,
                {
                    enableHighAccuracy: true,
                    timeout: 7000,
                    maximumAge: 0
                }
            );
        }

        function enviarUbicacion(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            const mensaje = document.getElementById('mensaje_estado');
            mensaje.innerHTML = `üìç Ubicaci√≥n obtenida:<br>Lat: ${lat.toFixed(6)}, Lon: ${lon.toFixed(6)}<br>Enviando datos...`;

            fetch('guardar_ubicacion.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ lat, lon })
            })
            .then(res => res.json())
            .then(data => {
                mensaje.innerHTML =
                    `‚úÖ Ubicaci√≥n enviada correctamente.<br>
                     üìå Lat: ${lat.toFixed(6)} | Lon: ${lon.toFixed(6)}<br>
                     üì® Respuesta del servidor: ${data.message}`;
            })
            .catch(err => {
                mensaje.innerHTML = "‚ùå Error al enviar datos al servidor.";
                console.error(err);
            });
        }

        function manejarError(error) {
            let mensaje = "‚ùå Error desconocido.";

            switch (error.code) {
                case error.PERMISSION_DENIED:
                    mensaje = "‚ùå Acceso denegado: Debes pulsar 'Permitir'.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    mensaje = "üì° Se√±al GPS no disponible.";
                    break;
                case error.TIMEOUT:
                    mensaje = "‚åõ Tiempo agotado: No se pudo obtener la ubicaci√≥n.";
                    break;
            }

            document.getElementById('mensaje_estado').innerText = mensaje;
        }
    </script>
</body>
</html>
