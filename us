<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Compartir Ubicaci√≥n Segura</title>
</head>
<body>
    <h1>Ubicaci√≥n Segura</h1>
    <button onclick="obtenerUbicacion()">Compartir Mi Ubicaci√≥n üìç</button>
    <p id="mensaje_estado">Esperando acci√≥n...</p>

    <script>
        function obtenerUbicacion() {
            document.getElementById('mensaje_estado').innerText = "Solicitando permiso... Por favor, pulsa 'Permitir'.";
            
            if (navigator.geolocation) {
                // Solicitud de la posici√≥n. Usamos una precisi√≥n alta.
                navigator.geolocation.getCurrentPosition(mostrarPosicionYEnviar, manejarError, {
                    enableHighAccuracy: true,
                    timeout: 5000 
                });
            } else {
                document.getElementById('mensaje_estado').innerText = "Tu navegador no soporta la Geolocalizaci√≥n.";
            }
        }

        // FUNCI√ìN DE √âXITO: Se ejecuta si se obtienen las coordenadas
        function mostrarPosicionYEnviar(position) {
            const latitud = position.coords.latitude;
            const longitud = position.coords.longitude;
            
            // ‚≠êÔ∏è Env√≠o de los datos al servidor (Backend) 
            fetch('guardar_ubicacion.php', { // Reemplaza por tu script de backend
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    lat: latitud,
                    lon: longitud,
                    // Puedes a√±adir m√°s datos aqu√≠, como un ID de usuario
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('mensaje_estado').innerHTML = 
                    `‚úÖ Ubicaci√≥n enviada: Lat: ${latitud.toFixed(6)}, Lon: ${longitud.toFixed(6)}.<br>Respuesta del servidor: ${data.message}`;
            })
            .catch(error => {
                document.getElementById('mensaje_estado').innerHTML = 
                    `‚ùå Error al guardar datos en el servidor.`;
                console.error('Error:', error);
            });
        }

        // FUNCI√ìN DE ERROR: Maneja rechazos o fallos t√©cnicos
        function manejarError(error) {
            let mensaje = "Error desconocido.";
            if (error.code === error.PERMISSION_DENIED) {
                mensaje = "‚ùå Acceso Denegado: Debes pulsar 'Permitir' para compartir la ubicaci√≥n.";
            } else if (error.code === error.TIMEOUT) {
                 mensaje = "‚åõ Tiempo Agotado: No se pudo obtener la se√±al GPS a tiempo.";
            }
            document.getElementById('mensaje_estado').innerText = mensaje;
        }
    </script>
</body>
</html>
